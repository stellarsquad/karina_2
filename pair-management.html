
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta http-equiv="Last-Modified" content="0" />
  <meta http-equiv="If-Modified-Since" content="0" />
  <title>Pair Management - Karina's App</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css?v=2.0.0&t=1754315809466">
</head>
<body>
  <div class="frame">
    <div class="title">
      ğŸ’• PAIR MANAGEMENT
    </div>

    <div class="count-box">
      <div class="count-label">CURRENT PAIR</div>
      <div id="current-pair-info" style="color: #ff4081; font-size: 14px; margin: 15px 0;">
        <div id="pair-code-display">Not paired</div>
        <div id="user-role-display" style="font-size: 10px; color: #ffb6d5; margin-top: 10px;"></div>
      </div>
    </div>

    <div class="button-grid">
      <button id="create-new-pair-btn">â• CREATE PAIR</button>
      <button id="join-pair-btn">ğŸ”— JOIN PAIR</button>
      <button id="leave-pair-btn">ğŸšª LEAVE PAIR</button>
      <button onclick="location.href='index.html'">ğŸ  HOME</button>
    </div>

    <div class="stats-box" id="pair-stats" style="display: none;">
      <div>Pair Statistics</div>
      <div id="pair-created">Created: --</div>
      <div id="pair-members">Members: --</div>
    </div>

    <div class="footer">
      Manage your pair connection
    </div>
  </div>

  <!-- Join Pair Modal -->
  <div id="join-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <span>ğŸ”— JOIN PAIR</span>
        <button class="close-btn" id="close-join">âœ–</button>
      </div>
      <div style="color: #ffb6d5; font-size: 11px; margin: 20px 0; text-align: center;">
        <div style="margin-bottom: 15px;">Enter the 6-digit pair code:</div>
        <input type="text" id="join-code-input" placeholder="ABC123" maxlength="6" style="width: 100%; margin-bottom: 15px; background: rgba(255, 255, 255, 0.95); color: #333; border: 2px solid #ff9ec6; border-radius: 8px; padding: 12px; font-family: 'Press Start 2P', monospace; font-size: 12px; box-sizing: border-box;">
        <button id="confirm-join" style="width: 100%; background: linear-gradient(145deg, #4CAF50, #66BB6A);">
          JOIN
        </button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script src="script.js?v=2.0.0&t=1754315809466"></script>
  
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Load current pair info
      function loadPairInfo() {
        const pairCode = localStorage.getItem('currentPairId');
        const userRole = localStorage.getItem('currentUser');
        
        if (pairCode && userRole) {
          document.getElementById('pair-code-display').textContent = `Code: ${pairCode}`;
          document.getElementById('user-role-display').textContent = `Role: ${userRole === 'he' ? 'Dominant' : 'Submissive'}`;
        }
      }

      // Create new pair
      document.getElementById('create-new-pair-btn').addEventListener('click', async () => {
        try {
          const pairCode = Math.random().toString(36).substr(2, 6).toUpperCase();
          const userRole = 'he'; // Default to dominant for creator
          const userUID = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
          
          await db.collection("pairs").doc(pairCode).set({
            createdAt: new Date(),
            createdBy: userRole,
            users: [userRole]
          });

          localStorage.setItem('currentPairId', pairCode);
          localStorage.setItem('currentUser', userRole);
          localStorage.setItem('userUID', userUID);
          
          loadPairInfo();
          // Copy to clipboard
          if (navigator.clipboard) {
            navigator.clipboard.writeText(pairCode).then(() => {
              NotificationManager.show(`Pair created! Code ${pairCode} copied to clipboard!`, 'success', 5000);
            }).catch(() => {
              NotificationManager.show(`Pair created! Code: ${pairCode}`, 'success', 5000);
            });
          } else {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = pairCode;
            document.body.appendChild(textArea);
            textArea.select();
            try {
              document.execCommand('copy');
              NotificationManager.show(`Pair created! Code ${pairCode} copied to clipboard!`, 'success', 5000);
            } catch (err) {
              NotificationManager.show(`Pair created! Code: ${pairCode}`, 'success', 5000);
            }
            document.body.removeChild(textArea);
          }
        } catch (error) {
          NotificationManager.show('Error creating pair', 'error');
        }
      });

      // Join pair
      document.getElementById('join-pair-btn').addEventListener('click', () => {
        document.getElementById('join-modal').style.display = 'flex';
      });

      document.getElementById('confirm-join').addEventListener('click', async () => {
        const pairCode = document.getElementById('join-code-input').value.trim().toUpperCase();
        if (pairCode.length !== 6) {
          NotificationManager.show('Please enter a 6-digit code', 'error');
          return;
        }

        try {
          const pairDoc = await db.collection("pairs").doc(pairCode).get();
          if (!pairDoc.exists) {
            NotificationManager.show('Pair code not found', 'error');
            return;
          }

          const userRole = 'she'; // Default to submissive for joiner
          const userUID = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
          
          localStorage.setItem('currentPairId', pairCode);
          localStorage.setItem('currentUser', userRole);
          localStorage.setItem('userUID', userUID);
          
          document.getElementById('join-modal').style.display = 'none';
          loadPairInfo();
          NotificationManager.show('Successfully joined pair!', 'success');
        } catch (error) {
          NotificationManager.show('Error joining pair', 'error');
        }
      });

      // Leave pair
      document.getElementById('leave-pair-btn').addEventListener('click', () => {
        NotificationManager.showConfirmation(
          "Are you sure you want to leave this pair?",
          () => {
            localStorage.removeItem('currentPairId');
            localStorage.removeItem('currentUser');
            localStorage.removeItem('userUID');
            loadPairInfo();
            NotificationManager.show('Left pair successfully', 'success');
          }
        );
      });

      // Close modal
      document.getElementById('close-join').addEventListener('click', () => {
        document.getElementById('join-modal').style.display = 'none';
      });

      loadPairInfo();
    });
  </script>
</body>
</html>
