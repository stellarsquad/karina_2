<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Karina's Orgasm-O-Matic</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #0b0f24;
      font-family: 'Press Start 2P', monospace;
      color: #ffb6d5;
      text-align: center;
      padding: 20px;
    }

    .frame {
      border: 4px solid #ff4081;
      box-shadow: 0 0 0 4px #ff006a, 0 0 0 8px #ff9ec6;
      padding: 20px;
      display: inline-block;
      border-radius: 20px;
      max-width: 360px;
    }

    .title {
      font-size: 14px;
      color: #ffb6d5;
      text-align: left;
    }

    .version {
      float: right;
      font-size: 10px;
      color: #ffe6eb;
    }

    .count-box {
      position: relative;
      border: 2px solid rgba(255, 158, 198, 0.5);
      background: linear-gradient(135deg, rgba(31, 34, 53, 0.9), rgba(31, 34, 53, 0.7));
      padding: 15px;
      margin: 25px 0;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(255, 107, 158, 0.2),
                  inset 0 0 30px rgba(255, 107, 158, 0.1);
      backdrop-filter: blur(10px);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .count-box:hover {
      transform: scale(1.02);
      box-shadow: 0 0 30px rgba(255, 107, 158, 0.3),
                  inset 0 0 40px rgba(255, 107, 158, 0.15);
    }

    .count-label {
      font-size: 10px;
      color: #ffb6d5;
    }

    .count-value {
      font-size: 38px;
      color: #ff6b9e;
      margin: 15px 0;
      text-shadow: 0 0 10px rgba(255, 107, 158, 0.5),
                   0 0 20px rgba(255, 107, 158, 0.3);
      letter-spacing: 2px;
      animation: pulse-text 2s infinite ease-in-out;
    }

    @keyframes pulse-text {
      0% { text-shadow: 0 0 10px rgba(255, 107, 158, 0.5); }
      50% { text-shadow: 0 0 20px rgba(255, 107, 158, 0.8); }
      100% { text-shadow: 0 0 10px rgba(255, 107, 158, 0.5); }
    }

    .count-value.animate {
      animation: bounce 0.3s ease-in-out;
    }

    @keyframes bounce {
      0% { transform: scale(1); }
      30% { transform: scale(1.5); }
      60% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    .timestamp {
      font-size: 10px;
      color: #ffe6eb;
    }

    .button-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 20px 0;
    }

    button {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      padding: 12px;
      background: linear-gradient(145deg, #ff6b9e, #ff4081);
      border: 2px solid rgba(255, 255, 255, 0.1);
      color: white;
      cursor: pointer;
      box-shadow: 0 4px #c03d70, 0 0 15px rgba(255, 107, 158, 0.3);
      position: relative;
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(5px);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px #c03d70, 0 0 20px rgba(255, 107, 158, 0.5);
      background: linear-gradient(145deg, #ff4081, #ff6b9e);
    }

    button:active {
      top: 2px;
      box-shadow: 0 2px #c03d70;
    }

    .stats-box {
      background-color: #1f2235;
      border: 2px solid #ff9ec6;
      padding: 12px;
      font-size: 11px;
      color: #ffffff;
      text-align: center;
      line-height: 1.2;
      border-radius: 12px;
      margin-top: 20px;
      width: 220px;
      margin-left: auto;
      margin-right: auto;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .stats-box.show {
      display: block;
      opacity: 1;
    }

    .stats-box div {
      margin: 5px 0;
      text-align: center;
      font-size: 11px;
      transition: opacity 0.3s;
    }

    .stats-box.loading div {
      opacity: 0.5;
    }

    .button-press {
      transform: scale(0.95);
      transition: transform 0.1s;
    }

    button:active {
      transform: scale(0.95);
    }

    .saved-flash {
      animation: flash 0.5s;
    }

    @keyframes flash {
      0% { opacity: 0; }
      50% { opacity: 1; }
      100% { opacity: 0; }
    }

    .bonus-popup {
      position: absolute;
      font-size: 14px;
      color: #ffb6d5;
      animation: popfade 0.8s ease forwards;
      pointer-events: none;
      left: 50%;
      top: 80px;
      transform: translateX(-50%);
      z-index: 999;
    }

    @keyframes popfade {
      0% { opacity: 1; transform: translate(-50%, 0); }
      100% { opacity: 0; transform: translate(-50%, -30px); }
    }

    .footer {
      margin-top: 20px;
      font-size: 14px;
      color: #ff6b9e;
    }

    .footer span {
      color: red;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 10;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.8);
    }

    .modal-content {
      position: relative;
      background-color: #1f2235;
      border: 2px solid #ff4081;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(255, 64, 129, 0.5);
      width: 270px;
      max-width: 90%;
      z-index: 10000;
      transform: translateY(-170px);
    }

    .modal-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .modal-grid button {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      padding: 10px;
      background-color: #ff6b9e;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 10px;
      transition: all 0.2s;
      box-shadow: 2px 2px 0 #000;
    }

    .modal-grid button:hover {
      background-color: #ff4081;
    }

    .close {
      float: right;
      cursor: pointer;
      color: #ff9ec6;
      font-size: 12px;
    }
    @keyframes pulseFrame {
      0% { box-shadow: 0 0 0 4px #ff006a, 0 0 0 8px #ff9ec6; }
      50% { box-shadow: 0 0 12px 6px #ff4081, 0 0 16px 12px #ff69b4; }
      100% { box-shadow: 0 0 0 4px #ff006a, 0 0 0 8px #ff9ec6; }
    }
    .frame.pulse {
      animation: pulseFrame 1s ease;
    }
    .footer span.animate-heart {
      display: inline-block;
      animation: bounceHeart 0.6s ease;
    }
    @keyframes bounceHeart {
      0% { transform: scale(1); }
      30% { transform: scale(1.8) translateY(-10px); }
      60% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }


    button:hover {
      box-shadow: 0 0 10px #ff4081, 0 0 20px #ff4081;
      background-color: #ff4081;
    }

    button:active {
      animation: shake 0.2s;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      50% { transform: translateX(2px); }
      75% { transform: translateX(-1px); }
      100% { transform: translateX(0); }
    }

    #saved-indicator {
      position: fixed;
      top: 10px;
      right: 14px;
      font-size: 10px;
      color: #ffffff;
      background-color: #1f2235;
      border: 2px solid #ff4081;
      border-radius: 6px;
      padding: 6px 10px;
      opacity: 0;
      pointer-events: none;
      font-family: 'Press Start 2P', monospace;
      z-index: 1000;
      transition: opacity 0.3s ease;
    }

    #saved-indicator.show {
      opacity: 1;
    }

    body.pink-theme .frame {
      border-color: #ff4081;
      box-shadow: 0 0 0 4px #ff006a, 0 0 0 8px #ff9ec6;
    }
    body.night-theme .frame {
      border-color: #444;
      box-shadow: 0 0 0 4px #111, 0 0 0 8px #333;
    }
    body.arcade-theme .frame {
      border-color: #00ffe1;
      box-shadow: 0 0 0 4px #00c9c9, 0 0 0 8px #007d7d;
    }
    body.love-theme .frame {
      border-color: #ff0040;
      box-shadow: 0 0 0 4px #ff0040, 0 0 8px 4px #ffc0cb;
    }

    body.night-theme button {
      background-color: #333;
      color: #ccc;
    }
    body.arcade-theme button {
      background-color: #00ffe1;
      color: #000;
    }
    body.love-theme button {
      background-color: #ff0040;
      color: white;
    }

    #theme-select {
      background-color: #1f2235;
      border: 2px solid #ff4081;
      color: #ffb6d5;
      padding: 6px 8px;
      border-radius: 8px;
      margin-left: 8px;
      box-shadow: 2px 2px 0 #000;
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      outline: none;
    }

    #theme-select:focus {
      border-color: #ff9ec6;
      box-shadow: 0 0 6px #ff4081;
    }

    .count-box {
      position: relative;
      overflow: hidden;
    }

    #floating-hearts-container {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .floating-heart {
      position: absolute;
      bottom: 0;
      font-size: 12px;
      animation: floatUp 4s ease-in forwards;
      opacity: 0.6;
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0) scale(1);
        opacity: 0.8;
      }
      50% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100px) scale(1.2);
        opacity: 0;
      }
    }

    .count-label,
    .count-value,
    .timestamp {
      position: relative;
      z-index: 2;
    }

    @keyframes counterGlow {
      0% { box-shadow: 0 0 4px #ff9ec6; }
      25% { box-shadow: 0 0 10px #ff6b9e; }
      50% { box-shadow: 0 0 16px #ff4081; }
      75% { box-shadow: 0 0 10px #ff6b9e; }
      100% { box-shadow: 0 0 4px #ff9ec6; }
    }

    .count-box {
      animation: counterGlow 10s ease-in-out infinite;
    }

    .footer span {
      animation: heartPulse 3s ease-in-out infinite;
      display: inline-block;
      font-size: 150%;
      transform-origin: center;
    }

    @keyframes heartPulse {
      0% { transform: scale(1); }
      30% { transform: scale(1.15); }
      60% { transform: scale(1); }
      100% { transform: scale(1.1); }
    }

    .progress-container {
      width: 100%;
      height: 10px;
      background-color: #1a1c2c;
      border: 1px solid #ff9ec6;
      border-radius: 6px;
      margin: 10px 0 14px;
      overflow: hidden;
      box-shadow: inset 0 0 6px rgba(255, 64, 129, 0.4);
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, #ff4081, #ff9ec6);
      transition: width 0.4s ease;
    }

    .progress-labels {
      display: flex;
      justify-content: space-between;
      font-size: 10px;
      color: #ffb6d5;
      margin-top: 2px;
      margin-bottom: 12px;
      padding: 0 4px;
      font-family: 'Press Start 2P', monospace;
    }

    .progress-wrapper {
      position: relative;
      width: 100%;
      margin-top: 10px;
      margin-bottom: 10px;
      text-align: center;
    }

    .mid-label-absolute {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      color: #ffb6d5;
      font-family: 'Press Start 2P', monospace;
      pointer-events: none;
    }

    @keyframes pulse-border {
      0% { box-shadow: 0 0 0 0 rgba(255,64,129,0.7); }
      70% { box-shadow: 0 0 0 10px rgba(255,64,129,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,64,129,0); }
    }

    .frame {
      animation: pulse-border 3s infinite;
    }

    .count-value::after {
      content: " üíñ";
      display: inline-block;
      animation: bounce-heart 2s infinite;
    }

    @keyframes bounce-heart {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }

    .heart-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
      border-radius: 12px;
    }

    .heart {
      position: absolute;
      bottom: -10px;
      font-size: 14px;
      color: #ff9ec6;
      filter: drop-shadow(0 0 2px rgba(255, 155, 193, 0.5));
      will-change: transform;
    }

    @keyframes float-up {
      0% {
        transform: translateY(100%) translateX(-50%) scale(1) rotate(0deg);
        opacity: 0.8;
      }
      50% {
        opacity: 0.5;
        transform: translateY(50%) translateX(calc(-50% + 20px)) scale(1.1) rotate(10deg);
      }
      100% {
        transform: translateY(0%) translateX(calc(-50% - 20px)) scale(0.8) rotate(-10deg);
        opacity: 0;
      }
    }

    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      display: none;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #fff;
      margin-bottom: 15px;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 12px;
      color: #ffb6d5;
      cursor: pointer;
    }

    .full-width {
      grid-column: span 2;
    }
  </style>
</head>
<body>
  <div class="frame">
    <div class="title">
      KARINA'S<br />ORGASM-O-MATIC <span class="version">v1.5</span>
    </div>

    <div class="count-box">
      <div class="heart-container" id="heart-container"></div>
      <div id="floating-hearts-container"></div>
      <div class="count-label">TOTAL COUNT</div>
      <div class="count-value" id="counter-display">0</div>
      <div class="timestamp" id="last-timestamp">Last: --:--:--</div>
    </div>

    <div class="progress-wrapper">
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="progress-labels">
        <span>0</span>
        <span>100</span>
      </div>
      <div class="mid-label-absolute">50</div>
    </div>

    <div class="button-grid">
      <button id="increment-btn">‚ûï ADD ONE</button>
      <button id="location-btn">üìç LOCATION</button>
      <button id="undo-btn">‚§∫ UNDO</button>
      <button id="reset-btn">‚ü≥ RESET</button>
      <button id="stats-btn" style="grid-column: span 2;">üìä STATS</button>
    </div>

    <div class="stats-box" id="stats-display">
      <div id="stat-today">Today: 0</div>
      <div id="stat-week">This Week: 0</div>
      <div id="stat-month">This Month: 0</div>
      <div id="stat-record">Record: 0</div>
    </div>

    <div class="footer">I love you <span>‚ô•</span></div>
  </div>

  <!-- Location Modal -->
  <div id="location-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <span>SELECT LOCATION</span>
        <button class="close-btn" id="close-location">‚úñ</button>
      </div>
      <div class="modal-grid">
        <button id="location-taxi">üöï TAXI +2</button>
        <button id="location-subway">üöá SUBWAY +3</button>
        <button id="location-cafe">‚òï CAFE +4</button>
        <button id="location-guest">üëØ GUEST +5</button>
        <button id="location-bonus" class="full-width">‚ú® BONUS +1</button>
      </div>
    </div>
  </div>

  <div id="saved-indicator">üíæ Saved</div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDdvKeBfe8p2UC8dCkXziECUlJEUw3_l4s",
      authDomain: "karina-5d44d.firebaseapp.com",
      projectId: "karina-5d44d",
      storageBucket: "karina-5d44d.appspot.com",
      messagingSenderId: "930914134264",
      appId: "1:930914134264:web:0e527a744b3d2c7182330d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const docRef = db.collection("users").doc("karina");
    const statsRef = db.collection("users").doc("karina_stats");

    let counter = 0;

    function updateDisplay() {
      const percent = Math.min(counter / 100, 1) * 100;
      document.getElementById("counter-display").textContent = counter;
      const progress = document.getElementById("progress-bar");
      progress.style.width = percent + "%";
    }

    function createFloatingHeart() {
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.innerText = ["üíñ", "üíó", "üíù", "üíï"][Math.floor(Math.random() * 4)];
      heart.style.left = (10 + Math.random() * 80) + "%";
      heart.style.fontSize = (12 + Math.random() * 8) + "px";
      heart.style.animation = `float-up ${2.5 + Math.random() * 2}s ease-in-out forwards`;
      document.getElementById("heart-container").appendChild(heart);
      setTimeout(() => heart.remove(), 4500);
    }

    function updateStatsDisplay(data) {
      document.getElementById("stat-today").textContent = `Today: ${data.today || 0}`;
      document.getElementById("stat-week").textContent = `This Week: ${data.week || 0}`;
      document.getElementById("stat-month").textContent = `This Month: ${data.month || 0}`;
      document.getElementById("stat-record").textContent = `Record: ${data.record || 0}`;
    }

    async function updateFirestoreStats(increment = 1) {
      const todayKey = new Date().toISOString().slice(0, 10);
      try {
        const snapshot = await statsRef.get();
        let data = snapshot.exists ? snapshot.data() : {
          today: 0, week: 0, month: 0, record: 0, lastUpdated: todayKey
        };

        if (increment < 0) {
          if (data.today <= 0 && data.week <= 0 && data.month <= 0) return;
          data.today = Math.max(0, (data.today || 0) + increment);
          data.week = Math.max(0, (data.week || 0) + increment);
          data.month = Math.max(0, (data.month || 0) + increment);
        } else {
          data.today = data.lastUpdated === todayKey ? (data.today || 0) + increment : increment;
          data.week = (data.week || 0) + increment;
          data.month = (data.month || 0) + increment;
          data.record = Math.max(data.record || 0, counter);
          data.lastUpdated = todayKey;
        }

        await statsRef.set(data);
        updateStatsDisplay(data);
      } catch (e) {
        console.error("Error updating stats:", e);
      }
    }

    async function loadStats() {
      const statsBox = document.getElementById("stats-display");
      statsBox.classList.add("loading");
      try {
        const snapshot = await statsRef.get();
        if (snapshot.exists) {
          updateStatsDisplay(snapshot.data());
        }
      } catch (e) {
        console.error("Failed to load stats:", e);
      } finally {
        statsBox.classList.remove("loading");
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      // Start heart animations
      setInterval(createFloatingHeart, 600);
      for(let i = 0; i < 5; i++) {
        setTimeout(createFloatingHeart, i * 200);
      }

      // Location modal handling
      const locationBtn = document.getElementById("location-btn");
      const locationModal = document.getElementById("location-modal");
      const closeModal = document.getElementById("close-location");

      locationBtn.addEventListener("click", () => {
        locationModal.style.display = "flex";
      });

      closeModal.addEventListener("click", () => {
        locationModal.style.display = "none";
      });

      // Location bonus handling
      const locationBonuses = {
        "location-taxi": 2,
        "location-subway": 3,
        "location-cafe": 4,
        "location-guest": 5,
        "location-bonus": 1
      };

      Object.keys(locationBonuses).forEach((id) => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener("click", async () => {
            try {
              await handleIncrement(locationBonuses[id]);
              locationModal.style.display = "none";
              for(let i = 0; i < 3; i++) {
                createFloatingHeart();
              }
            } catch (e) {
              console.error("Location bonus error:", e);
            }
          });
        }
      });

      // Button event handlers
      const incrementHistory = [];
      const MAX_HISTORY = 100;

      async function handleIncrement(increment) {
        try {
          const snapshot = await docRef.get();
          const currentCount = snapshot.exists ? snapshot.data().count : 0;
          counter = currentCount + increment;
          incrementHistory.push(increment);
          if (incrementHistory.length > MAX_HISTORY) {
            incrementHistory.shift();
          }
          updateDisplay();
          const now = new Date();
          const timeStr = now.toLocaleTimeString();
          document.getElementById("last-timestamp").textContent = `Last: ${timeStr}`;
          await docRef.set({ 
            count: counter,
            lastTimestamp: timeStr 
          }, { merge: true });
          await updateFirestoreStats(increment);
        } catch (e) {
          console.error("Increment error:", e);
        }
      }

      document.getElementById("undo-btn").addEventListener("click", async () => {
        if (counter > 0 && incrementHistory.length > 0) {
          try {
            const lastIncrement = incrementHistory[incrementHistory.length - 1];
            counter -= lastIncrement;
            incrementHistory.pop();
            updateDisplay();
            await docRef.set({ count: counter }, { merge: true });
            await updateFirestoreStats(-lastIncrement);
          } catch (e) {
            console.error("Undo error:", e);
          }
        }
      });

      document.getElementById("increment-btn").addEventListener("click", async () => {
        await handleIncrement(1);
        createFloatingHeart();
      });

      document.getElementById("reset-btn").addEventListener("click", async () => {
        counter = 0;
        updateDisplay();
        await docRef.set({ count: 0 }, { merge: true });
        await statsRef.set({
          today: 0,
          week: 0,
          month: 0,
          record: 0,
          lastUpdated: new Date().toISOString().slice(0, 10)
        });
        updateStatsDisplay({ today: 0, week: 0, month: 0, record: 0 });
      });

      document.getElementById("stats-btn").addEventListener("click", () => {
        document.getElementById("stats-display").classList.toggle("show");
        loadStats();
      });

      // Listen for counter updates
      docRef.onSnapshot((doc) => {
        if (doc.exists) {
          counter = doc.data().count || 0;
          updateDisplay();
        }
      });
    });
  </script>
</body>
</html>